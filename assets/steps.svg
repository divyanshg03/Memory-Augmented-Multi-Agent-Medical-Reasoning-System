<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="420" viewBox="0 0 1200 420" role="img" aria-label="Orchestrator steps diagram">
  <defs>
    <style>
      .bg { fill: #0b1220; }
      .title { fill: #e6edf7; font: 700 22px Inter, Segoe UI, Arial, sans-serif; }
      .muted { fill: #9db1d6; font: 500 14px Inter, Segoe UI, Arial, sans-serif; }
      .box { fill: #111b33; stroke: #2a3a66; stroke-width: 2; }
      .num { fill: #7aa2ff; font: 800 20px Inter, Segoe UI, Arial, sans-serif; }
      .text { fill: #c9d6f0; font: 600 16px Inter, Segoe UI, Arial, sans-serif; }
      .small { fill: #a9bce2; font: 500 13px Inter, Segoe UI, Arial, sans-serif; }
      .arrow { stroke: #7aa2ff; stroke-width: 2.5; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7aa2ff" />
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="1200" height="420" rx="18" />
  <text class="title" x="40" y="55">Pipeline Steps (pipeline/orchestrator.py)</text>
  <text class="muted" x="40" y="82">Each episode runs through these steps in order.</text>

  <g transform="translate(60,130)">
    <rect class="box" x="0" y="0" width="210" height="150" rx="14" />
    <text class="num" x="18" y="40">1</text>
    <text class="text" x="48" y="40">Patient identity</text>
    <text class="small" x="18" y="75">Store/reuse profile in Qdrant</text>
    <text class="small" x="18" y="98">memory/patient_memory.py</text>
  </g>

  <g transform="translate(300,130)">
    <rect class="box" x="0" y="0" width="210" height="150" rx="14" />
    <text class="num" x="18" y="40">2</text>
    <text class="text" x="48" y="40">Episode ingestion</text>
    <text class="small" x="18" y="75">Write a “pending” episode</text>
    <text class="small" x="18" y="98">memory/episode_ingestion.py</text>
  </g>

  <g transform="translate(540,130)">
    <rect class="box" x="0" y="0" width="210" height="150" rx="14" />
    <text class="num" x="18" y="40">3</text>
    <text class="text" x="48" y="40">Memory retrieval</text>
    <text class="small" x="18" y="75">Patient + population context</text>
    <text class="small" x="18" y="98">memory/case_retrieval.py</text>
  </g>

  <g transform="translate(780,130)">
    <rect class="box" x="0" y="0" width="210" height="150" rx="14" />
    <text class="num" x="18" y="40">4</text>
    <text class="text" x="48" y="40">Agent loop</text>
    <text class="small" x="18" y="75">Specialists reason + exchange</text>
    <text class="small" x="18" y="98">agents/agent_loop.py</text>
  </g>

  <g transform="translate(1020,130)">
    <rect class="box" x="0" y="0" width="210" height="150" rx="14" />
    <text class="num" x="18" y="40">5</text>
    <text class="text" x="48" y="40">Learning update</text>
    <text class="small" x="18" y="75">Persist decision + confidence</text>
    <text class="small" x="18" y="98">memory/memory_updater.py</text>
  </g>

  <path class="arrow" d="M 270 205 L 300 205" />
  <path class="arrow" d="M 510 205 L 540 205" />
  <path class="arrow" d="M 750 205 L 780 205" />
  <path class="arrow" d="M 990 205 L 1020 205" />

  <text class="muted" x="40" y="365">Outputs are returned via CLI (main.py) and the FastAPI server (api/app.py).</text>
</svg>
